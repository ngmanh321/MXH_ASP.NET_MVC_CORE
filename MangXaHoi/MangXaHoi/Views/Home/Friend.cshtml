
@{
    ViewData["Title"] = "Friend";
    Layout = "~/Views/Shared/_LayoutProfile.cshtml";
}
@{
	var tk = Context.Session.GetString("DN");
	var avatar = Context.Session.GetString("Avatar");

}

@model MangXaHoi.Models.Nguoidung

	<div class="col-lg-12">
						<div class="row merged20" id="page-contents">

		<div class="user-profile">

			<figure>
				<div class="edit-pp">
					<label class="fileContainer">
						<i class="fa fa-camera"></i>
						<input type="file">
					</label>
				</div>
				<img src="@Url.Content("../Layout/images/" + Model.AnhBia)" alt="">
				<ul class="profile-controls">
					<li id="addfriend"><a onclick="ThemFriend('@Model.TaiKhoan' , '@Model.Avatar')" title="Add friend" data-toggle="tooltip"><i class="fa fa-user-plus"></i></a></li>
					<li id="unfriend" style="display:none;"><a onclick="XoaFriend('@Model.TaiKhoan')" title="Under friend" data-toggle="tooltip"><i class="fa fa-user-plus"></i></a></li>
					<li id="acceptfriend" style="display:none;"><a onclick="ChapnhanFriend('@Model.TaiKhoan' , '@Model.Avatar')" title="Accept friend" data-toggle="tooltip"><i class="fa fa-user-plus"></i></a></li>
					<li id="refusefriend" style="display:none;"><a onclick="TuchoiFriend('@Model.TaiKhoan')" title="Refuse friend" data-toggle="tooltip"><i class="fa fa-user-plus"></i></a></li>
					<li id="friended" style="display:none;"><a onclick="XoaFriend('@Model.TaiKhoan')" title="Friended" data-toggle="tooltip"><i class="fa fa-user-plus"></i></a></li>
					<li id="friended1" style="display:none;"><a onclick="TuchoiFriend('@Model.TaiKhoan')" title="Friended" data-toggle="tooltip"><i class="fa fa-user-plus"></i></a></li>

					<li><a href="#" title="Follow" data-toggle="tooltip"><i class="fa fa-star"></i></a></li>
					<li><a class="send-mesg" href="#" title="Send Message" data-toggle="tooltip"><i class="fa fa-comment"></i></a></li>
					<li>
						<div class="edit-seting" title="Edit Profile image">
							<i class="fa fa-sliders"></i>
							<ul class="more-dropdown">
								<li><a href="setting.html" title="">Update Profile Photo</a></li>
								<li><a href="setting.html" title="">Update Header Photo</a></li>
								<li><a href="setting.html" title="">Account Settings</a></li>
								<li><a href="support-and-help.html" title="">Find Support</a></li>
								<li><a class="bad-report" href="#" title="">Report Profile</a></li>
								<li><a href="#" title="">Block Profile</a></li>
							</ul>
						</div>
					</li>
				</ul>
				<ol class="pit-rate">
					<li class="rated"><i class="fa fa-star"></i></li>
					<li class="rated"><i class="fa fa-star"></i></li>
					<li class="rated"><i class="fa fa-star"></i></li>
					<li class="rated"><i class="fa fa-star"></i></li>
					<li class=""><i class="fa fa-star"></i></li>
					<li><span>4.7/5</span></li>
				</ol>
			</figure>

			<div class="profile-section">
				<div class="row">
					<div class="col-lg-2 col-md-3">
						<div class="profile-author">
							<div class="profile-author-thumb">
								<img alt="author" src="@Url.Content("../Layout/images/"+ Model.Avatar)">
								<div class="edit-dp">
									<label class="fileContainer">
										<i class="fa fa-camera"></i>
										<input type="file">
									</label>
								</div>
							</div>

							<div class="author-content">
								<a class="h4 author-name">@Model.Ten</a>
								<div class="country">Ontario, CA</div>
							</div>
						</div>
					</div>
					<div class="col-lg-10 col-md-9">
						<ul class="profile-menu">
							<li>
								<a class="" asp-controller="Home" asp-action="DongThoiGian" asp-route-taikhoan="@Model.TaiKhoan">Timeline</a>
							</li>
							<li>
								<a class="" asp-controller="Home" asp-action="TrangCaNhan" asp-route-taikhoan="@Model.TaiKhoan">About</a>
							</li>
							<li>
								<a class="active" asp-controller="Home" asp-action="Friend" asp-route-taikhoan="@Model.TaiKhoan">Friends</a>
							</li>
							<li>
								<a class="" href="timeline-photos.html">Photos</a>
							</li>
							<li>
								<a class="" href="timeline-videos.html">Videos</a>
							</li>
							<li>
								<div class="more">
									<i class="fa fa-ellipsis-h"></i>
									<ul class="more-dropdown">
										<li>
											<a href="timeline-groups.html">Profile Groups</a>
										</li>
										<li>
											<a href="statistics.html">Profile Analytics</a>
										</li>
									</ul>
								</div>
							</li>
						</ul>
						<ol class="folw-detail">
							<li><span>Posts</span><ins>101</ins></li>
							<li><span>Followers</span><ins>1.3K</ins></li>
							<li><span>Following</span><ins>22</ins></li>
						</ol>
					</div>
				</div>
			</div>

		</div><!-- user profile banner  -->

		<div class="col-lg-12">
								<div class="central-meta">
									<div class="title-block">
										<div class="row">
											<div class="col-lg-6">
												<div class="align-left">
													<h5>Friends / Followers <span>44</span></h5>
												</div>
											</div>
											<div class="col-lg-6">
												<div class="row merged20">
													<div class="col-lg-7 col-lg-7 col-sm-7">
														<form method="post">
															<input type="text" placeholder="Search Friend">
															<button type="submit"><i class="fa fa-search"></i></button>
														</form>
													</div>
													<div class="col-lg-4 col-md-4 col-sm-4">
														<div class="select-options">
															<select class="select" style="display: none;">
																<option>Sort by</option>
																<option>A to Z</option>
																<option>See All</option>
																<option>Newest</option>
																<option>oldest</option>
															</select>
														</div>
													</div>
													<div class="col-lg-1 col-md-1 col-sm-1">
														<div class="option-list">
															<i class="fa fa-ellipsis-v"></i>
															<ul>
																<li><a title="" href="#">Show Friends Public</a></li>
																<li><a title="" href="#">Show Friends Private</a></li>
																<li><a title="" href="#">Mute Notifications</a></li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div><!-- title block -->

								<div class="central-meta padding30">
									<span class="create-post">send to</span>
									<div id="display" class="row">
										<div class="col-lg-3 col-md-6 col-sm-6">
											@*DisPlay*@	
										</div>															
									</div>

									<span class="create-post">receive from</span>
									<div id="display1" class="row">
											@*DisPlay*@	
									</div>
									<div class="lodmore">
										<span>Viewing 1-8 of 44 friends</span>
										<button class="btn-view btn-load-more"></button>
									</div>
								</div>
							</div>	
						</div>	
					</div>

<script>

	window.addEventListener('load', function () {
		// Thực hiện function myFunction ở đây
		GetAddFriend('@Model.TaiKhoan');
		GetAddFriend1('@Model.TaiKhoan');

	});

	//phia gui yeu cau
	function ThemFriend(tk, avatar) {
		let formData = {
			Tkgui: "@tk",
			Tknhan: tk,
			TrangThai: "0",
			AvatarGui: '@avatar',
			AvatarNhan: avatar,


		}

		$.ajax({
			type: "POST",
			url: "https://localhost:7013/api/api3/",
			data: JSON.stringify(formData),
			dataType: "json",
			contentType: "application/json; charset=utf-8",
			success: function (response) {
				location.reload();

			},
			error: function (request, status, error) {
				alert(request.responseText);
			},
		});


	}

	//phia gui yeu cau
	function XoaFriend(tknhan) {

		$.ajax({
			type: "DELETE",
			url: "https://localhost:7013/api/api3/" + '@tk' + '/' + tknhan,
			dataType: "json",
			success: function (response) {
				location.reload();

			},
			error: function (request, status, error) {
				alert(request.responseText);
			}
		});
	}

	//phia nhan yeu cau
	function ChapnhanFriendaasa(tk, avatar) {
		let formData = {
			Tkgui: tk,
			Tknhan: "@tk",
			TrangThai: "1",
			AvatarGui: avatar,
			AvatarNhan: '@avatar',


		}

		$.ajax({
			type: "POST",
			url: "https://localhost:7013/api/api3/",
			data: JSON.stringify(formData),
			dataType: "json",
			contentType: "application/json; charset=utf-8",
			success: function (response) {
				location.reload();

			},
			error: function (request, status, error) {
				alert(request.responseText);
			},
		});


	}

	function ChapnhanFriend(tk, avatar) {
		let formData = {
			Tkgui: tk,
			Tknhan: "@tk",
			TrangThai: "1",
			AvatarGui: avatar,
			AvatarNhan: '@avatar',


		};

		$.ajax({
			url: "https://localhost:7013/api/api3/" + tk + '/' + '@tk',
			type: 'PUT',
			contentType: 'application/json',
			data: JSON.stringify(formData),
			success: function (result) {
				location.reload();
			},
			error: function (xhr, status, error) {
				console.log('Lỗi khi cập nhật thông tin sản phẩm: ' + error);
			}
		});
	}

	//phia nhan yeu cau
	function TuchoiFriend(tkgui) {
		$.ajax({
			type: "DELETE",
			url: "https://localhost:7013/api/api3/" + tkgui + '/' + '@tk',
			dataType: "json",
			success: function (response) {
				location.reload();

			},
			error: function (request, status, error) {
				alert(request.responseText);
			}
		});
	}

	//phia gui yeu cau
	function GetAddFriend(tk) {
		var btn1 = document.getElementById("addfriend");
		var btn2 = document.getElementById("unfriend");
		var btn3 = document.getElementById("acceptfriend");
		var btn4 = document.getElementById("refusefriend");
		var btn5 = document.getElementById("friended");
		var display = '';
		var str = '';
		var tknhan = '';
		$.ajax({
			type: 'GET',
			url: 'https://localhost:7013/api/api3/' + tk,
			dataType: 'json',
			success: function (data) {
				$.each(data, function (key, val) {
					str = val.trangThai;
					if(str == 1 ){
						display += `
												<div class="col-lg-3 col-md-6 col-sm-6">
													<div class="friend-box">
														<figure>
															<img src="../Layout/images/resources/frnd-cover1.jpg" alt="">
															<span>Followers: 120</span>
														</figure>
														<div class="frnd-meta">
															<img style="width: 87px; height: 87px;" src="../Layout/images/${val.avatarNhan}" alt="">
															<div class="frnd-name">
																<a href="https://localhost:7013/Home/TrangCaNhan?taikhoan=${val.tknhan}" title="">${val.tknhan}</a>
																<span>California, USA</span>
															</div>
															<ul class="frnd-info">
			
															</ul>
															<a class="send-mesg" href="#" title="">Message</a>
															<div class="more-opotnz">
																<i class="fa fa-ellipsis-h"></i>
																<ul>
																	<li><a href="#" title="">Block</a></li>
																	<li><a href="#" title="">UnBlock</a></li>
																	<li><a href="#" title="">Mute Notifications</a></li>
																	<li><a href="#" title="">hide from friend list</a></li>
																</ul>
															</div>
														</div>
													</div>
									    	</div>

							`
					}
					tknhan = val.tknhan;

					if (str == 0 && tknhan == tk) {
						btn1.style.display = "none";
						btn2.style.display = "block";


					}
					if (str == 1 && tknhan == tk) {
						btn1.style.display = "none";
						btn5.style.display = "block";

					}
					if ('@tk' == tk) {
						btn1.style.display = "none";
						btn2.style.display = "none";
					}

				});
				$('#display').html(display);

			},

			Error: function (xhr) {
				alert(xhr.resposeText)
			},

		});
	}

	//phia nhan yeu cau
	function GetAddFriend1(tk) {
		var btn1 = document.getElementById("addfriend");
		var btn2 = document.getElementById("unfriend");
		var btn3 = document.getElementById("acceptfriend");
		var btn4 = document.getElementById("refusefriend");
		var btn5 = document.getElementById("friended1");

		var display='';
		var str = '';
		var tkgui = '';
		$.ajax({
			type: 'GET',
			url: 'https://localhost:7013/api/api3/0/' + tk,
			dataType: 'json',
			success: function (data) {
				$.each(data, function (key, val) {
					str = val.trangThai;
					if (str == 1) {
						display += `
												<div class="col-lg-3 col-md-6 col-sm-6">
														<div class="friend-box">
															<figure>
																<img src="../Layout/images/resources/frnd-cover1.jpg" alt="">
																<span>Followers: 120</span>
															</figure>
															<div class="frnd-meta">
																<img style="width: 87px; height: 87px;" src="../Layout/images/${val.avatarGui}" alt="">
																<div class="frnd-name">
																	<a href="https://localhost:7013/Home/TrangCaNhan?taikhoan=${val.tkgui}" title="">${val.tkgui}</a>
																	<span>California, USA</span>
																</div>
																<ul class="frnd-info">

																</ul>
																<a class="send-mesg" href="#" title="">Message</a>
																<div class="more-opotnz">
																	<i class="fa fa-ellipsis-h"></i>
																	<ul>
																		<li><a href="#" title="">Block</a></li>
																		<li><a href="#" title="">UnBlock</a></li>
																		<li><a href="#" title="">Mute Notifications</a></li>
																		<li><a href="#" title="">hide from friend list</a></li>
																	</ul>
																</div>
															</div>
														</div>
													</div>

								`
					}

					tkgui = val.tkgui;

					if (str == 0 && tkgui == tk) {
						btn1.style.display = "none";
						btn2.style.display = "none";
						btn3.style.display = "block";
						btn4.style.display = "block";

					}

					if (str == 1 && tkgui == tk) {
						btn1.style.display = "none";
						btn5.style.display = "block";
					}

				});
					$('#display1').html(display);

			},

			Error: function (xhr) {
				alert(xhr.resposeText)
			},

		});
	}
</script>
